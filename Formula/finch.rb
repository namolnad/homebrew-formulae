class Finch < Formula
  desc "Command-line tool to return a subset of JSON input based on a simple schema"
  homepage "https://github.com/namolnad/finch"
  url "https://github.com/namolnad/finch.git",
      tag:      "0.3.0",
      revision: "076cfd08cb59b4d90f76e3379e59951172cb4292"
  license "MIT"
  head "https://github.com/namolnad/finch.git", branch: "main"

  def install
    system "make", "build_with_disable_sandbox"
    bin.install ".build/release/finch"
  end

  test do
    input = "> &&&fce9cb800905de678a99577a64c8230e63f1cc37&&& - @@@[autocomplete-v3] add analytics (#1030)@@@###elvis1935+still-alive@theking.com###\n> &&&2236c36e40c4409927fdcd2b6ebd29b18aa03e36&&& - @@@[express-placement] build error fix (#1025)@@@###jony.ive@apple.com###\n> &&&9a33ff13804bcce98a4c81279cc1254e499e4932&&& - @@@[push-notificatons] Request for permission after user places an order with 90 day re-prompt (#1024)@@@###jony.ive@apple.com###\n> &&&092510f3eb3f85592b6973858c2b9591dd78d692&&& - @@@[express-placement] additional clean-up for analytics and bugs (#1021)@@@###jony.ive@apple.com###\n> &&&6e12ce047d1513a148456ede004ed4d89cedcec5&&& - @@@[codable] better supported for AnyEncodables (#1022)@@@###elvis1935+still-alive@theking.com###\n> &&&97021013d7873f399a911f87568f02f359f2c6bd&&& - @@@[analytics] Current production express placements are missing subscription_id in express_start.purchase tracking events (#1020)@@@###jony.ive@apple.com###\n> &&&e10fb1f08c6e139099eb74109e6372cd45958440&&& - @@@[bug] Don\'t show express placement every cold start (#1019)@@@###jony.ive@apple.com###\n> &&&70fbd7117720f22ddd118f60add4b55238663703&&& - @@@Syncing express params across checkout modules (#1016)@@@###long_live_the_citadel@rick.com###\n> &&&853bfd88f304d16a9caf817c39dda4f057160b04&&& - @@@[bug fix] fix LossyCodableArray (#1017)@@@###long_live_the_citadel@rick.com###\n> &&&036a288658f1b4a11ed1d649394d1e049eb7c4e6&&& - @@@[tests] fix order snapshots (#1018)@@@###long_live_the_citadel@rick.com###\n> &&&23ac4d92a5a735dc31c64197eddedd856cc85fcc&&& - @@@Order status V2.5 (#988)@@@###elvis1935+still-alive@theking.com###\n> &&&18d8350f4dddbea42ba3acf752ad4325b8f13d9d&&& - @@@[search] consolidate searchBar cornerRadius to 4, increase autocomplete-v3 term height (#1011)@@@###elvis1935+still-alive@theking.com###\n> &&&ab9406d731c18e6500c82e865034e87fdf7986e1&&& - @@@[bug fix] minor bug fixes for cubs/pbi (#1010)@@@###elvis1935+still-alive@theking.com###\n> &&&f2a7e851e982e1d61a54dbea2f199e9d5d2404e8&&& - @@@Update all express placements to one screen (#975)@@@###jony.ive@apple.com###\n> &&&b8a61e1fe83feabac08d3beda5237612e2d60d54&&& - @@@[carthage] move google places to internal carthage (#1008)@@@###elvis1935+still-alive@theking.com###\n> &&&29cd90a5eb4bbad531e098f673eefe43d45d44a5&&& - @@@[platform] background actions (#955)@@@###elvis1935+still-alive@theking.com###\n> &&&d157b78a5f440654ee243c676642466ff72912a6&&& - @@@[rollbar] update to v1.0.0 final (#1007)@@@###elvis1935+still-alive@theking.com###\n> &&&a7586919f6b096d884958e3386e535ecc986cd57&&& - @@@Autocomplete V3 (#1004)@@@###elvis1935+still-alive@theking.com###\n> &&&1c659ebb3dfde5b078894741a75eb0e3387656f2&&& - @@@[version] 6.13.0@@@###elvis1935+still-alive@theking.com###"
    expected_output = "\n# 6.20.0 (612)\n\n### Features\n - |tests| fix order snapshots - [PR #1018](/pull/1018) - long_live_the_citadel@rick.com\n - |search| consolidate searchBar cornerRadius to 4, increase autocomplete-v3 term height - [PR #1011](/pull/1011) - elvis1935+still-alive@theking.com\n - |rollbar| update to v1.0.0 final - [PR #1007](/pull/1007) - elvis1935+still-alive@theking.com\n - |push-notificatons| Request for permission after user places an order with 90 day re-prompt - [PR #1024](/pull/1024) - jony.ive@apple.com\n - |platform| background actions - [PR #955](/pull/955) - elvis1935+still-alive@theking.com\n - |express-placement| build error fix - [PR #1025](/pull/1025) - jony.ive@apple.com\n - |express-placement| additional clean-up for analytics and bugs - [PR #1021](/pull/1021) - jony.ive@apple.com\n - |codable| better supported for AnyEncodables - [PR #1022](/pull/1022) - elvis1935+still-alive@theking.com\n - |carthage| move google places to internal carthage - [PR #1008](/pull/1008) - elvis1935+still-alive@theking.com\n - |autocomplete-v3| add analytics - [PR #1030](/pull/1030) - elvis1935+still-alive@theking.com\n - |analytics| Current production express placements are missing subscription_id in express_start.purchase tracking events - [PR #1020](/pull/1020) - jony.ive@apple.com\n - Update all express placements to one screen - [PR #975](/pull/975) - jony.ive@apple.com\n - Syncing express params across checkout modules - [PR #1016](/pull/1016) - long_live_the_citadel@rick.com\n - Order status V2.5 - [PR #988](/pull/988) - elvis1935+still-alive@theking.com\n - Autocomplete V3 - [PR #1004](/pull/1004) - elvis1935+still-alive@theking.com\n\n### Bug Fixes\n - |bug| Don\'t show express placement every cold start - [PR #1019](/pull/1019) - jony.ive@apple.com\n - |bug fix| minor bug fixes for cubs/pbi - [PR #1010](/pull/1010) - elvis1935+still-alive@theking.com\n - |bug fix| fix LossyCodableArray - [PR #1017](/pull/1017) - long_live_the_citadel@rick.com\n"
    command = "finch compare --git-log \"#{input}\" --versions '6.20.0 5.3.0' --build-number 612"
    output = shell_output(command).chomp
    assert_match expected_output, output
  end
end
